<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util" xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.2.xsd
						http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.2.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd">

	<bean id="jabberBaseDataSource" class="org.apache.commons.dbcp2.BasicDataSource">
        <qualifier value="myBatisDataSource" />
		<property name="driverClassName" value="#{configProperties['db.base.driver']}" />
		<property name="url" value="#{configProperties['db.base.url']}" />
		<property name="username" value="#{configProperties['db.base.username']}" />
		<property name="password" value="#{configProperties['db.base.password']}" />
        <property name="maxTotal" value="#{configProperties['db.base.maxTotal']}" />
        <property name="defaultQueryTimeout" value="#{configProperties['db.base.defaultQueryTimeout']}" />
        <property name="defaultAutoCommit" value="false" />
        <property name="validationQuery" value="select 1" />
	</bean>

    <bean id="jabberBaseSqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
        <property name="dataSource" ref="jabberBaseDataSource" />
        <property name="mapperLocations" value="classpath*:com/icent/jabber/repository/mapper/base/*.xml" />
        <property name="typeAliasesPackage" value="com.icent.jabber.repository.bean" />
    </bean>

    <bean id="baseSqlSession" class="org.mybatis.spring.SqlSessionTemplate">
        <constructor-arg index="0" ref="jabberBaseSqlSessionFactory" />
    </bean>

    <bean class="org.mybatis.spring.mapper.MapperScannerConfigurer">
        <property name="basePackage" value="com.icent.jabber.repository.dao.base" />
        <property name="sqlSessionFactoryBeanName" value="jabberBaseSqlSessionFactory" />
    </bean>

    <!-- ########### -->
    <!-- Transaction Manager -->
    <!-- ########### -->
    <tx:annotation-driven transaction-manager="mybatisBaseTxManager" />

    <!-- japple Base -->
    <bean id="mybatisBaseTxManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
        <property name="dataSource" ref="jabberBaseDataSource" />
        <qualifier value="mybatisBaseTxManager" />
    </bean>


    <!--
        jabber log write datasource
     -->
    <bean id="jabberLogDataSource" class="org.apache.commons.dbcp2.BasicDataSource">
        <qualifier value="myBatisDataSource" />
        <property name="driverClassName" value="#{configProperties['db.log.driver']}" />
        <property name="url" value="#{configProperties['db.log.url']}" />
        <property name="username" value="#{configProperties['db.log.username']}" />
        <property name="password" value="#{configProperties['db.log.password']}" />
        <property name="maxTotal" value="#{configProperties['db.log.maxTotal']}" />
        <property name="defaultQueryTimeout" value="#{configProperties['db.log.defaultQueryTimeout']}" />
        <property name="defaultAutoCommit" value="false" />
        <property name="validationQuery" value="select 1" />
    </bean>

    <bean id="jabberLogSqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
        <property name="dataSource" ref="jabberLogDataSource" />
        <property name="mapperLocations" value="classpath*:com/icent/jabber/repository/mapper/log/*.xml" />
        <property name="typeAliasesPackage" value="com.icent.jabber.repository.bean" />
    </bean>

    <bean id="logSqlSession" class="org.mybatis.spring.SqlSessionTemplate">
        <constructor-arg index="0" ref="jabberLogSqlSessionFactory" />
    </bean>

    <bean class="org.mybatis.spring.mapper.MapperScannerConfigurer">
        <property name="basePackage" value="com.icent.jabber.repository.dao.log" />
        <property name="sqlSessionFactoryBeanName" value="jabberLogSqlSessionFactory" />
    </bean>

    <!-- ########### -->
    <!-- Transaction Manager -->
    <!-- ########### -->
    <tx:annotation-driven transaction-manager="mybatisLogTxManager" />

    <!-- japple Log -->
    <bean id="mybatisLogTxManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
        <property name="dataSource" ref="jabberLogDataSource" />
        <qualifier value="mybatisLogTxManager" />
    </bean>


    <!--
        isaver datasource
     -->
    <bean id="isaverDataSource" class="org.apache.commons.dbcp2.BasicDataSource">
        <qualifier value="isaverDataSource" />
        <property name="driverClassName" value="#{configProperties['db.isaver.driver']}" />
        <property name="url" value="#{configProperties['db.isaver.url']}" />
        <property name="username" value="#{configProperties['db.isaver.username']}" />
        <property name="password" value="#{configProperties['db.isaver.password']}" />
        <property name="maxTotal" value="#{configProperties['db.isaver.maxTotal']}" />
        <property name="defaultQueryTimeout" value="#{configProperties['db.isaver.defaultQueryTimeout']}" />
        <property name="defaultAutoCommit" value="false" />
        <property name="validationQuery" value="select 1" />
    </bean>

    <bean id="isaverSqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
        <property name="dataSource" ref="isaverDataSource" />
        <property name="mapperLocations" value="classpath*:com/icent/isaver/repository/mapper/base/*.xml" />
        <property name="typeAliasesPackage" value="com.icent.isaver.repository.bean" />
    </bean>

    <bean id="isaverSqlSession" class="org.mybatis.spring.SqlSessionTemplate">
        <constructor-arg index="0" ref="isaverSqlSessionFactory" />
    </bean>

    <bean class="org.mybatis.spring.mapper.MapperScannerConfigurer">
        <property name="basePackage" value="com.icent.isaver.repository.dao.base" />
        <property name="sqlSessionFactoryBeanName" value="isaverSqlSessionFactory" />
    </bean>

    <!-- ########### -->
    <!-- Transaction Manager -->
    <!-- ########### -->
    <tx:annotation-driven transaction-manager="mybatisIsaverTxManager" />

    <!-- isaver -->
    <bean id="mybatisIsaverTxManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
        <property name="dataSource" ref="isaverDataSource" />
        <qualifier value="mybatisIsaverTxManager" />
    </bean>
</beans>
